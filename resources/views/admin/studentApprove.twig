<script>
    var $ = jQuery.noConflict();
    var studentView = {
        URL: {
            studentApprove: ''
        },
        init: function (url) {
            var base = this;
            base.URL = url;
            $('.student-action').click(function () {
                base.studentApprove($(this));
            });
            $('input[name="filter"]').change(function () {
                base.studentFilter($(this));
            });
        },
        studentFilter: function (filter) {
            var id = $(filter).val();
            var base = this;
            $.ajax({
                type: 'POST',
                url: base.URL.studentFilter,
                data: {'id': id},
                success: function (data) {
                    var res = JSON.parse(data);
                    $('#the-list').html('');
                    $.each(res.listStudent, function (index, item) {
                        var row = '<tr>';
                        row += '<td><strong>' + item.profile_name + '</strong></td>';
                        row += '<td>' + (item.profile_gender === 1 ? 'Male' : 'Female') + '</td>';
                        if (item.approve === 1) {
                            row += '<td class="status"><span class="label label-success">Approved</span></td>';
                        } else if (item.approve === 2) {
                            row += '<td class="status"><span class="label label-danger">Rejected</span></td>';
                        } else {
                            row += '<td class="status"><span class="label label-info">Pending</span></td>';
                        }
                        row += '<td><div class="btn-group" role="group" aria-label="...">';
                        row += '<button type="button" onclick="studentView.studentApprove(this)" class="btn btn-primary student-action" data-student-id="' + item.student_id + '" data-status="1">Approve</button>';
                        row += '<button type="button" onclick="studentView.studentApprove(this)" class="btn btn-default student-action" data-student-id="' + item.student_id + '" data-status="2">Reject</button>';
                        row += '</div></td>';
                        row += '</tr>';
                        $('#the-list').append(row);
                    });
                }
            });
        },
        studentApprove: function (studentElement) {
            var id = $(studentElement).data('student-id');
            var status = $(studentElement).data('status');
            var base = this;
            $.ajax({
                type: 'POST',
                url: base.URL.studentApprove,
                data: {'id': id, 'status': status},
                success: function (data) {
                    var res = JSON.parse(data);
                    if (res.status === 'success') {
                        var tr = $(studentElement).closest('tr');
                        var strStatus = '';
                        if (status === 1) {
                            strStatus = '<span class="label label-success">Approved</span>';
                        } else {
                            strStatus = '<span class="label label-danger">Rejected</span>';
                        }
                        $(tr).find('.status')[0].innerHTML = strStatus;
                    }
                }
            });
        }
    };
    var URL = {
        studentFilter: '{{ route_url('Schola::schola-admin-student-filter') }}',
        studentApprove: '{{ route_url('Schola::schola-admin-student-approve') }}'
    };
    $(document).ready(function () {
        studentView.init(URL);
    });
</script>
<div class="wrap">
    <form id="posts-filter">
        <div class="form-group unit_name-control">
            <div class="btn-group" data-toggle="buttons">
                <label class="btn btn-primary active">
                    <input type="radio" class="filter" name="filter" id="option1" value="-1" autocomplete="off" checked> All
                </label>
                <label class="btn btn-primary">
                    <input type="radio" class="filter" name="filter" id="option2" value="1" autocomplete="off"> Approved
                </label>
                <label class="btn btn-primary">
                    <input type="radio" class="filter" name="filter" id="option3" value="2" autocomplete="off"> Rejected
                </label>
                <label class="btn btn-primary">
                    <input type="radio" class="filter" name="filter" id="option3" value="0" autocomplete="off"> Pending
                </label>
            </div>
        </div>
        <table class="wp-list-table widefat fixed striped posts">
            <thead>
            <tr>
                <th scope="col" class="manage-column column-primary">Name</th>
                <th scope="col" class="manage-column">Gender</th>
                <th scope="col" class="manage-column">Status</th>
                <th scope="col" class="manage-column">Action</th>
            </tr>
            </thead>
            <tbody id="the-list">
            {% for student in listStudent %}
                <tr class="student-{{ student.student_id }}">
                    <td>
                        <strong>{{ student.profile_name }}</strong>
                    </td>
                    <td><span class="student_des">{{ student.profile_gender == 1 ? 'Male' : 'Female' }}</span></td>
                    <td class="status">
                        {% if student.approve == 1 %}
                            <span class="label label-success">Approved</span>
                        {% elseif student.approve == 2 %}
                            <span class="label label-danger">Rejected</span>
                        {% else %}
                            <span class="label label-info">Pending</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="btn-group" role="group" aria-label="...">
                            <button type="button" class="btn btn-primary student-action" data-student-id="{{ student.student_id }}" data-status="1">Approve</button>
                            <button type="button" class="btn btn-default student-action" data-student-id="{{ student.student_id }}" data-status="2">Reject</button>
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
            <tfoot>
            <tr>
                <th scope="col" class="manage-column column-primary">Name</th>
                <th scope="col" class="manage-column">Gender</th>
                <th scope="col" class="manage-column">Status</th>
                <th scope="col" class="manage-column">Action</th>
            </tr>
            </tfoot>
        </table>
    </form>
    <div id="ajax-response"></div>
    <br class="clear">
</div>