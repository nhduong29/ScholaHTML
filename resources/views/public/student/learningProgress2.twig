{% set lang = Schola.language('student') %}

{% extends "@Schola/public/layout/layoutDashboard.twig" %}

{% block title %}{{ lang.schedule }}{% endblock %}

{% block head %}
    <script src="{{ Schola.helper( 'assetUrl' , '/public/js/student/schedule.js' ) }}" type="text/javascript"></script>
    <script src="{{ Schola.helper( 'assetUrl' , '/public/js/student/scheduleHandler.js' ) }}" type="text/javascript"></script>
    <script src="{{ Schola.helper( 'assetUrl' , '/public/js/classAccess/classAccess.js' ) }}" type="text/javascript"></script>
    <script src="{{ Schola.helper( 'assetUrl' , '/public/plugins/star-rating/jquery.star.rating.js' ) }}" type="text/javascript"></script>
    <script type="text/javascript">
        var URL = {
            cancelClass:                '{{ route_url('Schola::studentCancelClass') }}',
            cancelClassConfirmDialog:   '{{ route_url('Schola::studentCancelClassConfirmDialog') }}',
            rateClass:                  '{{ route_url('Schola::studentRateClass') }}',
            rateClassConfirmDialog:     '{{ route_url('Schola::studentRateClassConfirmDialog') }}',
            checkCancelClassConfirmDialog:   '{{ route_url('Schola::studentCheckCancelClassConfirmDialog') }}',
            action: '{{ route_url('Schola::schola_student_action')}}',
        };

        var URL1 = {
            checkClassTime: '{{ route_url('Schola::classroom-classtime') }}',
            classroomUrl: '{{ route_url("Schola::classroom")}}',
        };
        var MESSAGE= {
            checkPinBefore: '{{ lang.enter_class_before_schedule_time }}',
            checkPinAfter: '{{ lang.enter_class_after_schedule_time }}',
            checkPinInvalid : '{{ lang.enter_class_invalid_code }}',
        };
        $(document).ready(function(){
            scheduleView.init(URL);
            scheduleHandler.init(URL);
            classView.init(URL1, MESSAGE);
            $('#tabGroupClass').scholaTab();
            $('.star-rating').each(function (index, element) {
                $(element).addRating({
                    max : 5,
                    half : true,
                    fieldName : 'rating',
                    fieldId : 'rating',
                    icon : 'star',
                    callback : scheduleHandler.rate
                });
            });
            scheduleHandler.rate($('#star-rating-{{review_schdeule_id}}'),0);
        });
    </script>
{% endblock %}

{% block content %}
    <div>
        {% include "@Schola/public/student/navigation.twig" %}
    </div>
    <div class="container-fluid">
        <div class="content-width">
            <div class="panel-content">
                <div class="dashboard-content">
                    <div>
                        {% include "@Schola/public/student/leftNavigation.twig" %}
                    </div>
                    <div class="clearfix">
                        <div class="page-title">{{ lang.learning_progress_page_title|raw }}</div>
                        <div class="counter-class-completed mb30">
                            <div class="row">
                                <div class="col-xs-4 pr0-xs">
                                    <div class="text-center bold color-blue font-size-14-xs">{{ lang.completed_expert_classes }}</div>
                                    <h3 class="text-center bold color-orange mt5">{{ numberOfCompletedClasses.expertClass }}</h3>
                                </div>
                                <div class="col-xs-4 plr0-xs">
                                    <div class="text-center bold color-blue font-size-14-xs">{{ lang.completed_native_classes }}</div>
                                    <h3 class="text-center bold color-orange mt5">{{ numberOfCompletedClasses.nativeClass }}</h3>
                                </div>
                                <div class="col-xs-4 pl0-xs">
                                    <div class="text-center bold color-blue font-size-14-xs">{{ lang.completed_group_classes }}</div>
                                    <h3 class="text-center bold color-orange mt5">{{ numberOfCompletedClasses.groupClass }}</h3>
                                </div>
                            </div>
                        </div>
                        <div id="tabGroupClass" class="tabs-panel">
                            <ul class="tabs-bar three-tab">
                                <li class="tab active">
                                    <div class="title">{{ lang.booked }}</div>
                                </li>
                                <li class="tab ">
                                    <div class="title">{{ lang.completed }}</div>
                                </li>
                                <li class="tab ">
                                    <div class="title">{{ lang.canceled }}</div>
                                </li>
                            </ul>

                            <div class="tabs-content">
                                <div class="panel-list mb30 tab-item tab-0 active">
                                    <div class="title-list hidden-xs">{{ lang.booked }}</div>
                                    {% for class in bookedClasses %}
                                        <div class="practice-item label-top-xs">
                                            <div class="col-sm-2 col-xs-3 plr0-xs">
                                                <div class="user-info">
                                                    <div class="avatar img-box teacherAvatar" data-teacher-id="{{class.teacher_id}}" style="cursor: pointer;background-image: url({{ relatedTeacherAvatarUrls[class.teacher_id] }})"></div>
                                                    <div class="name">{{ relatedTeachers[class.teacher_id].teacher_firstname }}</div>
                                                </div>
                                            </div>
                                            <div class="col-sm-5 col-xs-9 pr0-xs">
                                                {% set isGroupClass = (class.group_id is not null and class.group_id != '0') %}
                                                {% if isGroupClass %}
                                                    <div class="title">{{ class.gc_lession_name }} </div>
                                                {% else %}
                                                    {% if class.lession_name is not null and class.lession_name != ""%}
                                                        <div class="title">{{ class.lession_name }} </div>
                                                    {% else %}
                                                        <div class="title">{{ class.lesson_title }} </div>
                                                    {% endif %}    
                                                {% endif %}

                                                {% set realScheduledTime = (class.schedule_real_date != null) ? class.schedule_real_date : class.schedule_date %}
                                                {% set scheduledTime = realScheduledTime|date_modify('+' ~ timezoneOffset*60 ~ ' minutes') %}
                                                <div class="time mb5">{{ scheduledTime|date('d/m/y') }} {{ lang.from }} {{ scheduledTime|date('H:i') }} - {{ scheduledTime|date_modify('+' ~ class.schedule_duration ~ ' minutes')|date('H:i') }}</div>

                                                {% if isGroupClass == false %}
                                                    <ul class="label-border">
                                                        <!-- <li class="green">{{ class.unit_name }}</li> -->
                                                        {% if class.lession_name is not null and class.lession_name != ""%}
                                                            <li class="green">{{ class.unit_name }}</li>
                                                        {% else %}
                                                             <li class="green">Level {{ class.lesson_level }} Unit {{ class.lesson_unit }}</li>
                                                        {% endif %}    
                                                        <!-- <span class="label-status">{{ lang.confirmed }}</span> -->
                                                        <li><span class="label-status native-confirmed-book {%if laststudentbooking == class.schedule_id %} waggle {%endif%}">{{ lang.confirmed }}</span></li>
                                                    </ul>
                                                {%else%}
                                                <ul class="label-border">
                                                        <!-- <span class="label-status">{{ lang.confirmed }}</span> -->
                                                        <li><span class="label-status native-confirmed-book {%if laststudentbooking == class.schedule_id %} waggle {%endif%}">{{ lang.confirmed }}</span>
                                                        </li>
                                                    </ul>
                                                {% endif %}
                                            </div>
                                            <div class="col-sm-5 col-xs-12">
                                                <div class="mt30 ml50">
                                                    <a class="btn btn-primary-2 btnAccessEnterClass"
                                                       data-text="{{ lang.enter_class }}"
                                                       data-id="{{ class.teacher_schedule_id }}" >
                                                        {{ lang.enter_class }}
                                                    </a>
                                                    <span class="btn btn-icon btn-close cancel-reserved-class-btn" data-schedule-id="{{ class.teacher_schedule_id }}" title="{{ lang.cancel }}"><i class="material-icons">highlight_off</i><span class="label-xs">{{ lang.cancel }}</span></span>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                    <div class="user_access_error">

                                    </div>
                                </div>

                                <div class="panel-list mb30 tab-item tab-1">
                                    <div class="title-list hidden-xs">{{ lang.completed }}</div>

                                    {% for class in completedClasses %}
                                        <div class="practice-item">
                                            <div class="col-sm-2 col-xs-3 plr0-xs">
                                                <div class="user-info">
                                                    <div class="avatar img-box teacherAvatar" data-teacher-id="{{class.teacher_id}}" style="cursor: pointer;background-image: url({{ relatedTeacherAvatarUrls[class.teacher_id] }})"></div>
                                                    <div class="name">{{ relatedTeachers[class.teacher_id].teacher_firstname }}</div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6 col-xs-9 pr0-xs">
                                                {% set isGroupClass = (class.group_id is not null and class.group_id != '0') %}
                                                {% if isGroupClass %}
                                                    <div class="title">{{ class.gc_lession_name }} </div>
                                                {% else %}
                                                    {% if class.lession_name is not null and class.lession_name != ""%}
                                                        <div class="title">{{ class.lession_name }} </div>
                                                    {% else %}
                                                        <div class="title">{{ class.lesson_title }} </div>
                                                    {% endif %}    
                                                {% endif %}

                                                {% set realScheduledTime = (class.schedule_real_date != null) ? class.schedule_real_date : class.schedule_date %}
                                                {% set scheduledTime = realScheduledTime|date_modify('+' ~ timezoneOffset*60 ~ ' minutes') %}
                                                <div class="time mb5">{{ scheduledTime|date('d/m/y') }} {{ lang.from }} {{ scheduledTime|date('H:i') }} - {{ scheduledTime|date_modify('+' ~ class.schedule_duration ~ ' minutes')|date('H:i') }}</div>

                                                {% if isGroupClass == false %}
                                                    <ul class="label-border">
                                                        {% if class.lession_name is not null and class.lession_name != ""%}
                                                            <li class="green">{{ class.unit_name }}</li>
                                                        {% else %}
                                                             <li class="green">Level {{ class.lesson_level }} Unit {{ class.lesson_unit }}</li>
                                                        {% endif %}    
                                                    </ul>
                                                {% endif %}
                                                <div class="check-finish"><span class="fa fa-check"></span></div>
                                            </div>
                                            <div class="col-sm-4 col-xs-12">
                                                <div class="rate-class mt20">
                                                    <div class="rate-icon">
                                                        {% if class.feedback_rate is null %}
                                                            <div id="star-rating-{{ class.schedule_id }}" class="star-rating star-rating-{{ class.schedule_id }}" data-schedule-id="{{ class.schedule_id }}"></div>
                                                            <span class="rate-link">{{ lang.rate_the_class }}</span>
                                                        {% else %}
                                                            {% set rate = (class.feedback_rate/2)|round %}
                                                            {% if rate == 0 %}
                                                                {% for i in 1..5 %}
                                                                    <i class="empty material-icons">star_border</i>
                                                                {% endfor %}
                                                            {% else %}
                                                                {% for i in 1..rate %}
                                                                    <i class="material-icons">star</i>
                                                                {% endfor %}

                                                                {% for i in 1..(5-rate) if (5-rate) >= 1 %}
                                                                    <i class="empty material-icons">star_border</i>
                                                                {% endfor %}
                                                            {% endif %}
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>

                                <div class="panel-list tab-item tab-2">
                                    <div class="title-list hidden-xs">{{ lang.canceled }}</div>

                                    {% for class in cancelledClasses %}
                                        <div class="practice-item">
                                            <div class="col-sm-2 col-xs-3 plr0-xs">
                                                <div class="user-info">
                                                    <div class="avatar img-box teacherAvatar" data-teacher-id="{{class.teacher_id}}" style="cursor: pointer;background-image: url({{ relatedTeacherAvatarUrls[class.teacher_id] }})"></div>
                                                    <div class="name">{{ relatedTeachers[class.teacher_id].teacher_firstname }}</div>
                                                </div>
                                            </div>
                                            <div class="col-sm-5 col-xs-9 pr0-xs">
                                                {% set isGroupClass = (class.group_id is not null and class.group_id != '0') %}
                                                {% if isGroupClass %}
                                                    <div class="title">{{ class.gc_lession_name }} </div>
                                                {% else %}
                                                    {% if class.lession_name is not null and class.lession_name != ""%}
                                                        <div class="title">{{ class.lession_name }} </div>
                                                    {% else %}
                                                        <div class="title">{{ class.lesson_title }} </div>
                                                    {% endif %}    
                                                {% endif %}

                                                {% set realScheduledTime = (class.schedule_real_date != null) ? class.schedule_real_date : class.schedule_date %}
                                                {% set scheduledTime = realScheduledTime|date_modify('+' ~ timezoneOffset*60 ~ ' minutes') %}
                                                <div class="time mb5">{{ scheduledTime|date('d/m/y') }} {{ lang.from }} {{ scheduledTime|date('H:i') }} - {{ scheduledTime|date_modify('+' ~ class.schedule_duration ~ ' minutes')|date('H:i') }}</div>

                                                {% if isGroupClass == false %}
                                                    <ul class="label-border">
                                                        {% if class.lession_name is not null and class.lession_name != ""%}
                                                            <li class="green">{{ class.unit_name }}</li>
                                                        {% else %}
                                                             <li class="green">Level {{ class.lesson_level }} Unit {{ class.lesson_unit }}</li>
                                                        {% endif %}    
                                                    </ul>
                                                {% endif %}
                                            </div>
                                            <div class="col-sm-5 col-xs-12">
                                                <div class="cancel-status mt35">
                                                    <span class="icon material-icons">close</span>
                                                    <span class="time-cancel">{{ lang.canceled_on }} ({{ class.updated_at|date('d/m/y') }} {{ class.updated_at|date('H:i') }})</span>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dot-color">
                    <div class="dot-1 hidden-xs"></div>
                    <div class="dot-2 hidden-xs"></div>
                    <div class="dot-3 hidden-xs"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="cancelConfirmDialogContaier">

    </div>
    <div>
        {%include "@Schola/public/dialog/cancelClassConfirmationDialog.twig"%}
    </div>
    <div id="rateConfirmDialogContaier">

    </div>
    <!-- Show teacher profile -->
                <div id="pnlDialogTeacherProfile">
                </div>
{% endblock %}