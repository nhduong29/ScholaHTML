{% set lang = Schola.language('student') %}

{% extends "@Schola/public/layout/layoutDashboard.twig" %}

{% block title %}{{ lang.schedule }}{% endblock %}

{% block head %}

 <script src="{{ Schola.helper( 'assetUrl' , '/public/js/classAccess/classAccess.js' ) }}" type="text/javascript"></script>  
    <script type="text/javascript">
        $(document).ready(function(){
          var showpopup= '{{ first_login }}';
          var showpopoup2= '{{ noAnyClassBook }}';
          if(showpopup !=""){
            $('#trialBookingDialog').modal('show');
            $('#refferaltrialBookingDialog').modal('hide');
         }
         if(showpopoup2 !=""){
            $('#refferaltrialBookingDialog').modal('show');
            $('#trialBookingDialog').modal('hide');
         }
         var URL = {
            checkTrialValidView: '{{ route_url('Schola::checkTrialValid') }}',
            studentDashboard: '{{ route_url('Schola::studentDashboard') }}'
        }

        var URL1 = {
            checkClassTime: '{{ route_url('Schola::classroom-classtime') }}',
            classroomUrl: '{{ route_url("Schola::classroom")}}',
        };
        var MESSAGE= {
            checkPinBefore: '{{ lang.enter_class_before_schedule_time }}',
            checkPinAfter: '{{ lang.enter_class_after_schedule_time }}',
            checkPinInvalid : '{{ lang.enter_class_invalid_code }}',
        };
        
        $(function () {
            checkTrialValidView.init(URL);
            classView.init(URL1,MESSAGE);
        });

             var checkTrialValidView = {
        URL: {
            checkTrialValidView: '',
            studentDashboard: ''
        },
        init: function (url) {
            var base = this;
            base.URL = url;
            $('#btnReferralAddBtn').click(function () {
                base._checkValidTrial();
            });
            /*base._pressEnterSubmitData();
            $('#month, #day, #year').on('change',function (e) {
                base._changeBirthDate();
            });*/
        },
        _checkValidTrial: function() {
            var base = this;
            $.ajax({
                type: "POST",
                url: base.URL.checkTrialValidView,
                data: $("#frmTrialPopup").serializeArray(),
                beforeSend: function () {
                    $('.show-error').removeClass('show-error');
                    $('.error').text('');
                },
                success: function (value) {
                    var res = JSON.parse(value);
                    if (res.status === 'success') {
                        window.location.href = base.URL.studentDashboard;
                    } else {
                        $.each(res.errors, function (index, item) {
                            $('.referral_input').css('border-color','red');
                            $('.error-message').text(item.value).show();
                        });
                        if (res.errorMetch === 'false') {
                             $('#profile_trial_code').val("");
                        }

                    }
                },
                complete: function () {
                    $('#btnUpdateInformation').removeAttr('disabled');
                }
            });
        }
    };
        });

        function  callTest() {
            $.ajax({
                type: "POST",
                url: '{{ route_url('Schola::booking-add-review') }}',
                data: {},
                success: function (value) {

                },
                complete: function () {

                }
            });
        }
    </script>
{% endblock %}

{% block content %}
    <div>
        {% include "@Schola/public/student/navigation.twig" %}
    </div>
    <div class="container-fluid">
        <div class="content-width">
            <div class="panel-content">
                <div class="dashboard-content">
                    <div>
                        {% include "@Schola/public/student/leftNavigation.twig" %}
                    </div>

                    <div class="clearfix">

                        <button onclick="callTest();">dadasdas</button>

                        <div class="page-title">{{ lang.choose_your_action|raw }}</div>
                        {% if bookedUplcomingClasses|length %}
                          <div class="access_class_upcoming dashboard_upcoming_class">
                                <div class="panel-list mb30 tab-item tab-0 active">
                                    <div class="title-list">{{ lang.upcoming_class }}</div>

                                    {% for class in bookedUplcomingClasses %}

                                        <div class="practice-item label-top-xs">
                                           
                                            <div class="col-sm-8 col-xs-6 col-md-8 pr0-xs">
                                                <div class="title">
                                                {%if class.group_id !=0 %}
                                                    {{ class.group_lession_name }} (Group)
                                                {%else%}
                                                    {% if class.lession_name is not null and class.lession_name != ""%}
                                                        <div class="title">{{ class.lession_name }} </div>
                                                    {% else %}
                                                        <div class="title">{{ class.lesson_title }} </div>
                                                    {% endif %}    
                                                {% endif %}
                                                </div>
                                                {%if class.group_id !=0 %}
                                                    {% set realScheduledTime = (class.schedule_real_date != null) ? class.schedule_real_date : class.schedule_date %}
                                                    {% set scheduledTime = realScheduledTime|date_modify('+' ~ timezoneOffset*60 ~ ' minutes') %}
                                                    <div class="time mb5">{{ scheduledTime|date('d/m/y') }} <span class="mobile-view-from"> {{ lang.from }} </span>{{ scheduledTime|date('H:i') }}<span class="mobile-view-from"> - {{ scheduledTime|date_modify('+' ~ class.group_schedule_duration ~ ' minutes')|date('H:i') }}</span></div>    
                                                {% else %}
                                                     {% set realScheduledTime = (class.schedule_real_date != null) ? class.schedule_real_date : class.schedule_date %}
                                                    {% set scheduledTime = realScheduledTime|date_modify('+' ~ timezoneOffset*60 ~ ' minutes') %}
                                                    <div class="time mb5">{{ scheduledTime|date('d/m/y') }} <span class="mobile-view-from"> {{ lang.from }} </span>{{ scheduledTime|date('H:i') }}<span class="mobile-view-from"> - {{ scheduledTime|date_modify('+' ~ class.schedule_duration ~ ' minutes')|date('H:i') }}</span></div>
                                                    {% endif %}
                                            
                                            </div>
                                            <div class="col-sm-4 col-xs-6 col-md-4">
                                                <div class="mt30">
                                                    <a id="btnAccessEnterClass"
                                                       class="btn btnAccessEnterClass"
                                                       data-text="{{ lang.enter_class }}"
                                                       data-id="{{ class.teacher_schedule_id }}" >
                                                        {{ lang.enter_class }}
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                    <div class="user_access_error">
                
                                    </div>
                                </div>

                          </div>
                        {%endif%}
                        <div class="row main-navigation">
                            <div class="col-sm-6 col-xs-12">
                                <a href="{{ route_url('Schola::studentNativeClass') }}" class="nav-item">
                                    <div class="nav-item-icon">
                                        <img src="{{ Schola.helper('assetUrl', '/public/images/icon/nav-item-1.2.png') }}" alt="BOOK A CLASS">
                                    </div>
                                    <div class="nav-item-name"><span>{{ lang.book_1_1_class }}</span></div>
                                </a>
                            </div>
                            <div class="col-sm-6 col-xs-12">
                                <a href="{{ route_url('Schola::studentAvailableGroupClass') }}" class="nav-item">
                                    <div class="nav-item-icon">
                                        <img src="{{ Schola.helper('assetUrl', '/public/images/icon/nav-item-1.3.png') }}" alt="BOOK A CLASS">
                                    </div>
                                    <div class="nav-item-name"><span>{{ lang.book_group_class|upper }}</span></div>
                                </a>
                            </div>
                            <div class="col-sm-6 col-xs-12">
                                <a href="{{ route_url('Schola::studentLearningProgress') }}" class="nav-item">
                                    <div class="nav-item-icon">
                                        <img src="{{ Schola.helper('assetUrl', '/public/images/icon/nav-item-3.png') }}" alt="CHECK LEARNING PROGRESS">
                                    </div>
                                    <div class="nav-item-name"><span>{{ lang.check_learning_progress }}</span></div>
                                </a>
                            </div>
                            <div class="col-sm-6 col-xs-12">
                                <a href="{{ route_url('Schola::practiceAndLessonReview') }}" class="nav-item">
                                    <div class="nav-item-icon">
                                        <img src="{{ Schola.helper('assetUrl', '/public/images/icon/nav-item-2.png') }}" alt="PRACTICE & REVIEW">
                                    </div>
                                    <div class="nav-item-name"><span>{{ lang.practice_and_review }}</span></div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dot-color">
                    <div class="dot-1 hidden-xs"></div>
                    <div class="dot-2 hidden-xs"></div>
                    <div class="dot-3 hidden-xs"></div>
                </div>
            </div>
        </div>
    </div>
    {% include "@Schola/public/student/freeBookingPopup.twig" %}
    {% include "@Schola/public/student/trialBookingPopup.twig" %}

{% endblock %}



